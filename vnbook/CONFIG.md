# vnbook é¡¹ç›®ç¯å¢ƒé…ç½®æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š

| è½¯ä»¶        | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬   | è¯´æ˜              |
| ----------- | -------- | ---------- | ----------------- |
| **Node.js** | 20.19.0  | 20.19+ LTS | JavaScript è¿è¡Œæ—¶ |
| **npm**     | 10+      | æœ€æ–°ç‰ˆ     | Node.js åŒ…ç®¡ç†å™¨  |
| **Docker**  | æœ€æ–°     | æœ€æ–°ç‰ˆ     | å®¹å™¨åŒ–å¹³å°        |
| **Git**     | 2.0+     | æœ€æ–°ç‰ˆ     | ç‰ˆæœ¬æ§åˆ¶å·¥å…·      |

**æ£€æŸ¥å·²å®‰è£…ç‰ˆæœ¬ï¼š**

```bash
node -v        # åº”æ˜¾ç¤º v20.19.0 æˆ–æ›´é«˜
npm -v         # åº”æ˜¾ç¤º 10.x.x æˆ–æ›´é«˜
docker -v      # åº”æ˜¾ç¤º Docker version
git --version  # åº”æ˜¾ç¤º git version
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5 åˆ†é’Ÿï¼‰

### 1ï¸âƒ£ å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd vnbook
```

### 2ï¸âƒ£ å®‰è£… Node.js ä¾èµ–

```bash
npm install
```

**é¢„æœŸè¾“å‡ºï¼š**

```
added 387 packages, and audited 388 packages in 45s
```

**è¯´æ˜ï¼š**

- å®‰è£…æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–ï¼ˆVueã€Vantã€Axios ç­‰ï¼‰
- å®‰è£…æ‰€æœ‰å¼€å‘ä¾èµ–ï¼ˆViteã€TypeScriptã€ESLint ç­‰ï¼‰
- æ ¹æ® `package-lock.json` é”å®šç²¾ç¡®ç‰ˆæœ¬
- å ç”¨ç£ç›˜ç©ºé—´çº¦ 200-500MB

---

## ğŸ³ Docker åˆ›å»ºè¿‡ç¨‹æ­¥éª¤

æ­å»ºä¸€ä¸ªå®Œæ•´çš„ LMPA åç«¯ PHP å¼€å‘è°ƒè¯•ç¯å¢ƒã€‚

### 1. å‡†å¤‡é¡¹ç›®ç›®å½•ç»“æ„

è¯·ç¡®ä¿ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹ç»“æ„åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š

```
<project-path>\vnbook\                  (é¡¹ç›®æ ¹ç›®å½•)
  â”œâ”€â”€ public\api\                       (å­˜æ”¾ä½ çš„ PHP åç«¯ä»£ç )
  â”œâ”€â”€ docker-compose.yml                (æ¥ä¸‹æ¥åˆ›å»º)
  â””â”€â”€ .docker\
      â”œâ”€â”€ Dockerfile                    (è‡ªå®šä¹‰ PHP é•œåƒ)
      â””â”€â”€ xdebug.ini                    (Xdebug é…ç½®)
```

### 2. ç¼–å†™ `.docker\Dockerfile`

å‚è§é¡¹ç›®ä¸­çš„ `.docker\Dockerfile` æ–‡ä»¶

### 3. ç¼–å†™ `.docker\xdebug.ini`

å‚è§é¡¹ç›®ä¸­çš„ `.docker\xdebug.ini` æ–‡ä»¶

### 4. ç¼–å†™æ ¸å¿ƒ `docker-compose.yml`

å‚è§é¡¹ç›®ä¸­çš„ `docker-compose.yml` æ–‡ä»¶

### 5. ä¸€é”®å¯åŠ¨

```bash
docker-compose up -d
```

Docker ä¼šè‡ªåŠ¨ä¸‹è½½é•œåƒã€ç¼–è¯‘å¸¦æœ‰ Xdebug çš„ PHPã€å¹¶å¯åŠ¨æ‰€æœ‰å®¹å™¨ã€‚

### 6. å¦‚ä½•éªŒè¯ç¯å¢ƒï¼Ÿ

| æœåŠ¡           | è®¿é—®åœ°å€              | è¯´æ˜                                  |
| -------------- | --------------------- | ------------------------------------- |
| **PHP API**    | http://localhost:8080 | å¯¹åº” `public\api` é‡Œçš„ä»£ç             |
| **phpMyAdmin** | http://localhost:8081 | ç™»å½•è´¦å·ï¼š`root` / å¯†ç è§ `dbcfg.php` |

### 7. VS Code å®‰è£… PHP Debug

æœ€åçš„å…³é”®è®¾ç½®ï¼š`.vscode/launch.json`

è¯·åŠ¡å¿…æ£€æŸ¥ä½  VS Code é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `.vscode/launch.json` æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå°±æ‰‹åŠ¨å»ºä¸€ä¸ªã€‚å†…å®¹å¿…é¡»åŒ…å« `pathMappings`ï¼Œå¦åˆ™ VS Code æ‰¾ä¸åˆ°æ–­ç‚¹å¯¹åº”çš„æ–‡ä»¶ã€‚

å‚è§é¡¹ç›®ä¸­çš„ `.vscode/launch.json` æ–‡ä»¶

---

### 5ï¸âƒ£ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

**é¢„æœŸè¾“å‡ºï¼š**

```
VITE v7.3.1  ready in 612 ms

âœ  Local:   http://localhost:5173/
âœ  Network: http://192.168.x.x:5173/
```

### 6ï¸âƒ£ è®¿é—®åº”ç”¨

**æœ¬åœ°è®¿é—®ï¼š**

```
http://localhost:5173
```

**ç§»åŠ¨è®¾å¤‡è®¿é—®ï¼ˆå±€åŸŸç½‘ï¼‰ï¼š**

```
http://192.168.x.x:5173
```

**é»˜è®¤ç™»å½•è´¦å·ï¼š**

- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`initvnb`

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

```
vnbook/
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ api/               # PHP åç«¯ API
â”‚   â”‚   â”œâ”€â”€ dbcfg.php     # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ getnonce.php  # ç™»å½• nonce ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ dologin.php   # ç™»å½•éªŒè¯
â”‚   â”‚   â”œâ”€â”€ books.php     # è¯ä¹¦ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ words.php     # å•è¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ ...           # å…¶ä»– API
â”‚   â””â”€â”€ resources/         # å›¾æ ‡ã€å›¾ç‰‡ç­‰
â”œâ”€â”€ src/                   # Vue 3 å‰ç«¯æºç 
â”‚   â”œâ”€â”€ api/              # API è¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ components/       # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ router/           # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ stores/           # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ views/            # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ App.vue           # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts           # åº”ç”¨å…¥å£
â”œâ”€â”€ docker-compose.yml    # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ vite.config.ts        # Vite æ„å»ºé…ç½®
â”œâ”€â”€ package.json          # é¡¹ç›®ä¾èµ–å®šä¹‰
â”œâ”€â”€ tsconfig*.json        # TypeScript é…ç½®
â””â”€â”€ .gitignore            # Git å¿½ç•¥è§„åˆ™
```

---

## ğŸ”§ å¼€å‘é…ç½®è¯´æ˜

### Vite å¼€å‘æœåŠ¡å™¨é…ç½®

**ç«¯å£ï¼š** `5173`  
**ä»£ç†é…ç½®ï¼š** `/api/*` â†’ `http://localhost:8080`

å‰ç«¯è¯·æ±‚ `/api/books.php` ä¼šè‡ªåŠ¨è½¬å‘åˆ° `http://localhost:8080/api/books.php`ï¼Œæ— éœ€é…ç½® CORSã€‚

### è®¿é—®åœ°å€é€Ÿè§ˆ

| ç”¨é€”       | åœ°å€                  |
| ---------- | --------------------- |
| å‰ç«¯åº”ç”¨   | http://localhost:5173 |
| PHP API    | http://localhost:8080 |
| phpMyAdmin | http://localhost:8081 |

### Docker æœåŠ¡é…ç½®

**PHP æœåŠ¡ï¼š**

- ç«¯å£ï¼š`8080`
- ç‰ˆæœ¬ï¼šPHP 8.2
- æ–‡æ¡£æ ¹ç›®å½•ï¼š`./public/api`

**MySQL æœåŠ¡ï¼š**

- ç«¯å£ï¼š`3306`
- æ•°æ®åº“åï¼š`va_vnbook`
- ç”¨æˆ·åï¼š`root`
- å¯†ç ï¼šï¼ˆè§ `docker-compose.yml`ï¼‰

### æµè§ˆå™¨å…¼å®¹æ€§

**å¼€å‘æ¨¡å¼ï¼ˆnpm run devï¼‰ï¼š**

- Chrome 80+ (2020)
- Firefox 74+ (2020)
- Safari 13.1+ (2020)
- Edge 80+ (2020)

**ç”Ÿäº§æ„å»ºï¼ˆnpm run buildï¼‰ï¼š**

- Chrome 51+ (2016)
- Firefox 54+ (2017)
- Safari 10+ (2016)
- Edge 15+ (2017)

ä½¿ç”¨ `@vitejs/plugin-legacy` æ’ä»¶è‡ªåŠ¨ç”Ÿæˆå…¼å®¹æ—§æµè§ˆå™¨çš„ä»£ç ã€‚

---

## ğŸ“¦ ä¾èµ–åŒ…è¯´æ˜

### è¿è¡Œæ—¶ä¾èµ–ï¼ˆ5ä¸ªï¼‰

| åŒ…å       | ç‰ˆæœ¬    | ç”¨é€”             |
| ---------- | ------- | ---------------- |
| vue        | ^3.5.26 | Vue 3 æ ¸å¿ƒæ¡†æ¶   |
| vue-router | ^4.6.4  | è·¯ç”±ç®¡ç†         |
| pinia      | ^3.0.4  | çŠ¶æ€ç®¡ç†         |
| vant       | ^4.9.22 | ç§»åŠ¨ç«¯ UI ç»„ä»¶åº“ |
| axios      | ^1.13.2 | HTTP è¯·æ±‚åº“      |

### å¼€å‘ä¾èµ–ï¼ˆ17ä¸ªï¼‰

**æ„å»ºå·¥å…·ï¼š** vite, @vitejs/plugin-vue, @vitejs/plugin-legacy, unplugin-vue-components  
**TypeScriptï¼š** typescript, vue-tsc, @types/node  
**ä»£ç è´¨é‡ï¼š** eslint, prettier, eslint-plugin-vue  
**å…¶ä»–å·¥å…·ï¼š** npm-run-all2, jiti ç­‰

**æ€»è®¡ï¼š** `npm install` ä¼šå®‰è£…çº¦ 300-400 ä¸ªåŒ…ï¼ˆåŒ…å«æ‰€æœ‰ä¼ é€’ä¾èµ–ï¼‰

---

## ğŸ¯ å¸¸ç”¨å‘½ä»¤

### å¼€å‘

```bash
npm run dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:5173ï¼‰
npm run build        # ç”Ÿäº§æ„å»ºï¼ˆè¾“å‡ºåˆ° dist/ï¼‰
npm run preview      # é¢„è§ˆç”Ÿäº§æ„å»º
```

### ä»£ç è´¨é‡

```bash
npm run lint         # ESLint æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤
npm run type-check   # TypeScript ç±»å‹æ£€æŸ¥
npm run format       # Prettier æ ¼å¼åŒ–ä»£ç 
```

### Docker

```bash
docker-compose up -d      # å¯åŠ¨åç«¯æœåŠ¡
docker-compose down       # åœæ­¢åç«¯æœåŠ¡
docker-compose logs -f    # æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose restart    # é‡å¯æœåŠ¡
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. npm install å¤±è´¥

**é—®é¢˜ï¼š** ç½‘ç»œè¶…æ—¶æˆ–ä¾èµ–å®‰è£…å¤±è´¥

**è§£å†³ï¼š**

```bash
# æ¸…é™¤ç¼“å­˜é‡è¯•
npm cache clean --force
npm install

# æˆ–ä½¿ç”¨å›½å†…é•œåƒ
npm config set registry https://registry.npmmirror.com
npm install
```

### 2. Docker å¯åŠ¨å¤±è´¥

**é—®é¢˜ï¼š** ç«¯å£ 8080 æˆ– 3306 è¢«å ç”¨

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8080
netstat -ano | findstr :3306

# ä¿®æ”¹ docker-compose.yml çš„ç«¯å£æ˜ å°„
# ä¾‹å¦‚ï¼š8080 â†’ 8081
```

### 3. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é—®é¢˜ï¼š** API è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤º CORS é”™è¯¯

**æ£€æŸ¥æ¸…å•ï¼š**

- [ ] Docker å®¹å™¨æ˜¯å¦è¿è¡Œä¸­ï¼š`docker ps`
- [ ] PHP æœåŠ¡æ˜¯å¦å¯è®¿é—®ï¼š`curl http://localhost:8080/api/`
- [ ] Vite proxy é…ç½®æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ `vite.config.ts`

**ä¸´æ—¶è§£å†³ï¼š** åœ¨ PHP æ–‡ä»¶ä¸­æ·»åŠ  CORS å¤´ï¼ˆä»…ç”¨äº preview æ¨¡å¼ï¼‰

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜ï¼š** PHP æŠ¥é”™ "Connection refused"

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ MySQL å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs db

# é‡å¯ MySQL å®¹å™¨
docker-compose restart db
```

### 5. æ—§æµè§ˆå™¨ä¸å…¼å®¹

**é—®é¢˜ï¼š** Firefox 71 æ˜¾ç¤ºè¯­æ³•é”™è¯¯

**è¯´æ˜ï¼š**

- å¼€å‘æ¨¡å¼éœ€è¦ç°ä»£æµè§ˆå™¨ï¼ˆChrome 80+ï¼‰
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `npm run build` ç”Ÿæˆå…¼å®¹ç‰ˆæœ¬
- æµ‹è¯•æ—§æµè§ˆå™¨å…¼å®¹æ€§è¯·ç”¨ `npm run preview`

---

## âœ… ç¯å¢ƒéªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œç¡®è®¤ç¯å¢ƒé…ç½®æ­£ç¡®ï¼š

- [ ] Node.js ç‰ˆæœ¬ â‰¥ 20.19.0
- [ ] `npm install` æˆåŠŸå®Œæˆï¼ˆæ— æŠ¥é”™ï¼‰
- [ ] Docker å®¹å™¨è¿è¡Œä¸­ï¼ˆ`docker ps` å¯è§ 2 ä¸ªå®¹å™¨ï¼‰
- [ ] PHP æœåŠ¡å¯è®¿é—®ï¼ˆ`curl http://localhost:8080/api/` æœ‰å“åº”ï¼‰
- [ ] æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼ˆ`init-db.php` è¿”å› successï¼‰
- [ ] `npm run dev` å¯åŠ¨æˆåŠŸï¼ˆæ— æŠ¥é”™ï¼‰
- [ ] æµè§ˆå™¨è®¿é—® `http://localhost:5173` å¯è§ç™»å½•é¡µ
- [ ] å¯ä»¥ä½¿ç”¨ `admin/initvnb` ç™»å½•æˆåŠŸ

---

## ğŸ” å®‰å…¨æç¤º

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - ç™»å½•åç«‹å³ä¿®æ”¹ admin å¯†ç 
   - æˆ–ä¿®æ”¹ `public/api/dbcfg.php` ä¸­çš„ `C_ADMIN_PASSINIT`

2. **é…ç½®æ•°æ®åº“å¯†ç **
   - ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ MySQL å¯†ç 
   - åŒæ­¥æ›´æ–° `public/api/dbcfg.php` ä¸­çš„æ•°æ®åº“é…ç½®

3. **åˆ é™¤è°ƒè¯•å·¥å…·**
   - ç§»é™¤ `index.html` ä¸­çš„ Eruda è°ƒè¯•ä»£ç ï¼ˆç¬¬ 20-26 è¡Œï¼‰

4. **é…ç½® CORS**
   - æ ¹æ®å®é™…åŸŸåé…ç½® `public/api/getnonce.php` å’Œ `login.php` çš„ CORS å¤´
   - æˆ–ä½¿ç”¨ Nginx åå‘ä»£ç†ç»Ÿä¸€åŸŸå

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **é¡¹ç›®è¯´æ˜ï¼š** [README.md](README.md)
- **é…ç½®è¯´æ˜ï¼š** [CONFIG.md](CONFIG.md)
- **Docker é…ç½®ï¼š** [docker-compose.yml](docker-compose.yml)
- **Vite æ–‡æ¡£ï¼š** https://vitejs.dev
- **Vue 3 æ–‡æ¡£ï¼š** https://vuejs.org
- **Vant UI æ–‡æ¡£ï¼š** https://vant-ui.github.io

---

## ğŸ’¬ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æœ¬æ–‡æ¡£çš„ã€Œå¸¸è§é—®é¢˜ã€ç« èŠ‚
2. æŸ¥çœ‹ Docker æ—¥å¿—ï¼š`docker-compose logs`
3. æŸ¥çœ‹ Vite å¼€å‘æœåŠ¡å™¨æ—¥å¿—
4. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

---

**é…ç½®å®Œæˆåï¼Œå¼€å§‹å¼€å‘å§ï¼** ğŸ‰
